---
title: "US Craft Beer Analysis"
author: "Nathan Wall, Muthu Palanisamy, Nathan Lara"
date: "February 15, 2018"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Analysis of US Craft beers Alcohol by Volume (ABV) & Internation Bitterness Unit (IBU)
We will be analyzing data on 2410 US craft beers from 558 different breweries to identify various characteristics of the US craft beer industry. Spefically we will be focusing on a beers ABV and IBU and there geographic properties and relationships to one another.

### Reading & Manipulating Data from source
The data for this analysis is stored on GitHub in the following repository:
https://github.com/nateewall/MSDS6306_CaseStudy1

We will be using R's RCurl package to read this data directly from the web.
```{r}
#if you do not have the RCurl package then install
#install.packages("RCurl")
#Reference RCurl package to read from web
require(RCurl)

# Read Breweries dataset
breweriesURL <- 'https://raw.githubusercontent.com/nateewall/MSDS6306_CaseStudy1/master/Breweries.csv'
Breweries <-read.csv(text=getURL(breweriesURL), header=T)

# Read the Beers Dataset
beersURL <- 'https://raw.githubusercontent.com/nateewall/MSDS6306_CaseStudy1/master/Beers.csv'
Beers <-read.csv(text=getURL(beersURL), header=T)
```


### Exploring the data
Once the data is read into R data.frames from the web we will quickly review the format of the data to make sure all feilds were captured appropriately.

Breweries:
```{r}
# Review the data
str(Breweries)
str(Beers)
summary(Breweries)
summary(Beers)
```

Our Breweries data.frame has 558 observations with 551 distinct breweries from 51 states and 384 different cities.

Below we will see how many breweries are located in each of the 51 states in our data:
```{r}
# How many breweries are present in each state?
BreweryStates <- summary(Breweries$State)
#Print in sorted order
sort(BreweryStates, decreasing = T)
```
Colorado has the most breweries in our data with 47 breweries, followed closely by California's 39. Arkansas has the fewest with 2.

### Merge the data sets together to have the geography for each of the beer.

Below is the code used to merge the two data sets by Brewery ID and a quick review of top and the bottom of our new data set.
```{r}
mergedBeerBreweries<-merge(
  Breweries, Beers, by.x = "Brew_ID", by.y ="Brewery_id", all= TRUE
)

# Assign appropriate name  
names(mergedBeerBreweries)[2]<-"BreweryName"
names(mergedBeerBreweries)[5]<-"BeerName"

#print the top 6 records
head(mergedBeerBreweries, 6)
#print the bottom 6 records
tail(mergedBeerBreweries, 6)
```

Based on the output above we can see that the data appears to have successfully been merged. Although there are lots of NA's in the for the IBU column so we will perform a count of all NA's in our data.

```{r}
# There are multiple ways to get the NA's
# Can go with sapply..
sapply(mergedBeerBreweries, function(x) sum(is.na(x)))
```

It appears the most of the columns have 0 NA's with the exception of 62 NA's for ABV & 1005 NA's for IBU. We are assuming this data was not available for the beers from this group.

### Analyzing the Beers ABV & IBU

First, we will begin by taking a look at the median alcohol content for each of the states to determine if there are any major differences.
```{r}
require(dplyr)
medianIBU <- data.frame(
  mergedBeerBreweries %>%
    group_by(State) %>% 
    summarise(median = median(IBU, na.rm = T))
)

medianIBU <- medianIBU[order(-medianIBU$median),]

# Set margins 
par(mar=c(5, 6, 4 ,2))

barplot(medianIBU$median, names.arg = medianIBU$State, 
        xlab="States",
        ylab="Median",
        main = 'IBU by State')
```

Breweies from Main (ME) has median IBU of 61ppm isohumulone, 
IBU is a scale that goes from 1-100, standard budwiser has 7.

Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?

```{r}
#get the max ABV
maxABV <- mergedBeerBreweries[which(mergedBeerBreweries$ABV == max(mergedBeerBreweries$ABV,na.rm = T)), ]
maxABV$State
```

Colorado in the dataset has the max alcohol by volumne (ABV) beer.
```{r}
#get the max IBU
maxIBU <- mergedBeerBreweries[which(mergedBeerBreweries$IBU == max(mergedBeerBreweries$IBU,na.rm = T)), ]
maxIBU$State
```

Astoria Bitter Bitch Imperial IPA has the max IBU of 138 from Portland, OR.
```{r}
# Summary statistics for the ABV variable.
summary(mergedBeerBreweries$ABV)
require(shiny)
server <- function(input, output) {
  # Define histogram output
  output$beerHist <- renderPlot({  # "beerHist" in UI also
    bc   <- as.numeric(input$var)  # bc = "beer column"
    x    <- mergedBeerBreweries[, bc]
    hist(x, 
         col    = '#8DC13D',  # Green 
         border = 'white',
         main   = paste("Histogram of", names(mergedBeerBreweries[bc]))
    )
  })
}

ui <- fluidPage(
  titlePanel("Charting Beer Data"),
  sidebarLayout(
    sidebarPanel(
      # Dropdown menu for selecting variable from beer data.
      selectInput("var",
                  label = "Select variable",
                  choices = c(
                              "ABV" = 7,
                              "IBU" = 8,
                              "Ounce"=10
                              ),
                  selected = 7)      # Default selection
    ),
    mainPanel(
      plotOutput("beerHist")  # "beerHist" in server also
    )
  )
)

shinyApp(ui = ui, server = server)
#hist(mergedBeerBreweries$ABV)
```

```{r}
# Is there an apparent relationship between the bitterness 
# of the beer and its alcoholic content? Draw a scatter plot.

mylm<-lm(mergedBeerBreweries$IBU ~ mergedBeerBreweries$ABV)
plot(mergedBeerBreweries$IBU, mergedBeerBreweries$ABV, 
     xlab="International Bitterness Units",
     ylab="Alcohol by volume",
     main = 'Alcohol Volume Vs. Bitterness correlation',
     col=rgb(0,100,0,150,maxColorValue=255), pch=16)
abline(lm(mergedBeerBreweries$ABV~mergedBeerBreweries$IBU), col="red")
summary(mylm)
```

There is an upward trend with the linear regression plot strongly suggests there is positive correlation between Alcohol volume and bitterness.