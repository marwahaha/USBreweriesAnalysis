---
title: "US Craft Beer Analysis"
author: "Muthu Palanisamy, Nathan Wall, Nathan Lara"
date: "February 28, 2018"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Analysis of US Craft beers Alcohol by Volume (ABV) & Internation Bitterness Unit (IBU)
We will be analyzing data on 2410 US craft beers from 558 different breweries to identify various characteristics of the US craft beer industry. Spefically we will be focusing on a beers ABV and IBU and there geographic properties as well as any relationships to one another.

### Reading & Manipulating Data from source
The data for this analysis is stored on GitHub in the following repository:
https://github.com/nateewall/MSDS6306_CaseStudy1

We will be using R's RCurl package to read this data directly from the web.
```{r}
#if you do not have the RCurl package then install
#install.packages("RCurl")
#Reference RCurl package to read from web
library(RCurl)

# Read Breweries dataset
breweriesURL <- 'https://raw.githubusercontent.com/nateewall/MSDS6306_CaseStudy1/master/Breweries.csv'
Breweries <-read.csv(text=getURL(breweriesURL), header=T)

# Read the Beers Dataset
beersURL <- 'https://raw.githubusercontent.com/nateewall/MSDS6306_CaseStudy1/master/Beers.csv'
Beers <-read.csv(text=getURL(beersURL), header=T)
```


### Exploring the data
Once the data is read into R data.frames from the web we will quickly review the format of the data to make sure all feilds were captured appropriately.

Breweries:
```{r}
# Review the data
str(Breweries)
str(Beers)
summary(Breweries)
summary(Beers)
```

Our Breweries data.frame has 558 observations with 551 distinct breweries from 51 states and 384 different cities.

Below we will see how many breweries are located in each of the 51 states in our data:
```{r}
# How many breweries are present in each state?
BreweryStates <- summary(Breweries$State)
#Print in sorted order
sort(BreweryStates, decreasing = T)
```
Colorado has the most breweries in our data with 47 breweries, followed closely by California's 39. Arkansas has the fewest with 2. Arkansas seems like a very unideal place for the beer fan, but perhaps a ripe area for new brewery development.

### Merge the data sets together to have the geography for each of the beer.

Below is the code used to merge the two data sets by Brewery ID and a quick review of top and the bottom of our new data set.
```{r}
mergedBeerBreweries<-merge(
  Breweries, Beers, by.x = "Brew_ID", by.y ="Brewery_id", all= TRUE
)

#lets include some additional state information for later use
mergedBeerBreweries$State<-trimws(mergedBeerBreweries$State)
# pull the state names to join with abreviated state name
states <- data.frame(cbind(state.abb, tolower(state.name)))
names(states) <- c('abrev','statename') #rename the vars
#join them together to have the complete statename
mergedData<-merge(
  mergedBeerBreweries, states, by.x = "State", by.y ="abrev", all= TRUE
)
#fill in missing statename for DC
mergedData$statename[which(mergedData$State=='DC')] <- "district of columbia"

# Assign appropriate name  
names(mergedData)[2]<-"BreweryName"
names(mergedData)[5]<-"BeerName"

#print the top 6 records
head(mergedData, 6)
#print the bottom 6 records
tail(mergedData, 6)
```

Based on the output above we can see that the data appears to have successfully been merged. Although there are lots of NA's in the for the IBU column so we will perform a count of all NA's in our data.

```{r}
# There are multiple ways to get the NA's
# Can go with sapply..
sapply(mergedData, function(x) sum(is.na(x)))
```

It appears the most of the columns have 0 NA's with the exception of 62 NA's for ABV & 1005 NA's for IBU. We are assuming this data was not available for the beers from this group.

### Analyzing the Beers ABV & IBU

First, we will begin by taking a look at the median alcohol content for each of the states to determine if there are any major differences.
```{r}
library(dplyr)
medianIBU <- data.frame(
  mergedData %>%
    group_by(State, statename) %>% 
    summarise(median = median(IBU, na.rm = T))
)

medianIBU <- medianIBU[order(-medianIBU$median),]

# Set margins 
par(mar=c(5, 6, 4 ,2))

barplot(medianIBU$median, names.arg = medianIBU$State, 
        xlab="States",
        ylab="Median",
        main = 'IBU by State',
        col=rgb(0,100,0,150,maxColorValue=255), pch=16)
```

Breweies from Maine (ME) has median IBU of 61ppm isohumulone, 
IBU is a scale that goes from 1-100, standard Budweiser has 7.

We recognize that this may be difficult to read so we also plot the median IBU for each State to help understand any geographical patterns.
```{r}
library(fiftystater)
library(ggplot2)

# summarize data by IBU
plotData <- data.frame(
  mergedData %>%
    group_by(statename) %>% 
    summarise(medianIBU = median(IBU, na.rm = T))
)

plotData$id <- as.character(plotData$statename)
data("fifty_states")
Total <- merge(fifty_states, plotData, by="id")


p <- ggplot(Total, aes(map_id = id)) + 
  # map points to the fifty_states shape data
  geom_map(aes(fill = medianIBU), map = fifty_states) + 
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) + 
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "") +
  theme(legend.position = "bottom", 
        panel.background = element_blank())
p1 <- p + scale_fill_continuous(low = "palegreen", high = "darkgreen", guide="colorbar")
# add border boxes to AK/HI
p2 <- p1 + fifty_states_inset_boxes() 
p2 + labs(fill = "Median IBU" 
          ,title = "Median IBU for Each State", x="", y="")

```
This shows some of the states with more bitter beer like Vermont, Florida, West Virginia. But also shows the states with less bitter beer like Wisconsin.

But, which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?

```{r}
#get the max ABV
maxABV <- mergedData[which(mergedData$ABV == max(mergedData$ABV,na.rm = T)), ]
paste0(maxABV$BeerName, " from ", maxABV$City, ", ", maxABV$State, " has the maximum ABV in our data with ", maxABV$ABV, sep=" ")
```
Colorado in the dataset has the max alcohol by volumne (ABV) beer. Additionally, here are the top 10 beers by ABV.
```{r}
top10ABV <- mergedData[order(-mergedData$ABV),][1:10,]
top10ABV[,c("BeerName","City","State","ABV")]
```
Both Colorado & Michigan are representated well in the top 10 with 5 of the top 10 by ABV. 

```{r}
#get the max IBU
maxIBU <- mergedData[which(mergedData$IBU == max(mergedData$IBU,na.rm = T)), ]
paste0(maxIBU$BeerName, " from ", maxIBU$City, ", ", maxIBU$State, " has the maximum ABV in our data with ", maxIBU$IBU, sep=" ")
```
Astoria Bitter Bitch Imperial IPA has the max IBU of 138 from Portland, OR. Additionally will we look at the top 10 beers by IBU.

```{r}
top10IBU <- mergedData[order(-mergedData$IBU),][1:10,]
top10IBU[,c("BeerName","City","State","IBU")]
```
It appears there may be a duplicate of the Heady Topper, although as they have different beer ID's.

```{r}
# Summary statistics for the ABV variable.
# summary(mergedBeerBreweries$ABV)
library(shiny)
server <- function(input, output) {
  # Define histogram output
  output$beerHist <- renderPlot({  # "beerHist" in UI also
    bc   <- as.numeric(input$var)  # bc = "beer column"
    x    <- mergedData[, bc]
    hist(x, 
         col    = '#8DC13D',  # Green 
         border = 'white',
         main   = paste("Histogram of", names(mergedBeerBreweries[bc]))
    )
  })
}

ui <- fluidPage(
  titlePanel("Charting Beer Data"),
  sidebarLayout(
    sidebarPanel(
      # Dropdown menu for selecting variable from beer data.
      selectInput("var",
                  label = "Select variable",
                  choices = c(
                              "ABV" = 7,
                              "IBU" = 8,
                              "Ounce"=10
                              ),
                  selected = 7)      # Default selection
    ),
    mainPanel(
      plotOutput("beerHist")  # "beerHist" in server also
    )
  )
)

shinyApp(ui = ui, server = server)
#hist(mergedBeerBreweries$ABV)
```

```{r}
# Is there an apparent relationship between the bitterness 
# of the beer and its alcoholic content? Draw a scatter plot.

mylm<-lm(mergedData$IBU ~ mergedData$ABV)
plot(mergedData$IBU, mergedData$ABV, 
     xlab="International Bitterness Units",
     ylab="Alcohol by volume",
     main = 'Alcohol Volume Vs. Bitterness correlation',
     col=rgb(0,100,0,150,maxColorValue=255), pch=16)
abline(lm(mergedData$ABV~mergedData$IBU), col="red")
```

There is an upward trend with the linear regression plot strongly suggests there is positive correlation between Alcohol volume and bitterness.
